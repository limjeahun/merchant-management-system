# ===============================================
# SPRING BOOT APPLICATION CONFIGURATION
# ===============================================
server:
  port: 8081
# ===============================================
# SPRING BOOT APPLICATION CONFIGURATION
# ===============================================
spring:
  application:
    name: mms-worker
  # ===============================================
  # DATABASE (MySQL) CONFIGURATION
  # ===============================================
  datasource:
    url: jdbc:mysql://localhost:3307/mms_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: mms
    password: mms
    driver-class-name: com.mysql.cj.jdbc.Driver
  # ===============================================
  # JPA & HIBERNATE CONFIGURATION
  # ===============================================
  jpa:
    hibernate:
      ddl-auto: update # 개발용
    show-sql: true
    properties:
      hibernate:
        format_sql: true
  # ===============================================
  # Redis CONFIGURATION
  # ===============================================
  data:
    redis:
      host: localhost
      port: 6379
  # ===============================================
  # Kafka CONFIGURATION
  # ===============================================
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: "ocr-worker-group"
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*"
        # Kafka Consumer 타임아웃 설정 (긴 OCR 처리를 위해 증가)
        max.poll.interval.ms: 600000       # 10분 - poll() 간격 최대 시간
        session.timeout.ms: 60000          # 60초 - 세션 타임아웃
        heartbeat.interval.ms: 20000       # 20초 - 하트비트 간격
        max.poll.records: 1                # 한 번에 1개 메시지만 처리 (긴 처리 시간 대응)

# ===============================================
# LOCAL OCR CONFIGURATION
# ===============================================

# PaddleOCR/RapidOCR 설정
paddleocr:
  api-url: ${PADDLEOCR_API_URL:http://localhost:9003}
  model-path: ${PADDLEOCR_MODEL_PATH:classpath:models/paddleocr}
  detection-model: ch_PP-OCRv4_det_infer.onnx
  recognition-model: korean_PP-OCRv3_rec_infer.onnx

# Ollama (Gemma3 - LangChain4j용)
ollama:
  base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
  model-name: gemma3:12b
  timeout: 300s
  temperature: 0.1  # 낮은 값 = 일관된 출력 (OCR용 권장: 0.0~0.3)

# ===============================================
# SPRING AI CONFIGURATION (Primary)
# ===============================================
spring.ai:
  ollama:
    base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
    chat:
      model: gemma3:12b
      options:
        temperature: 0.1

# ===============================================
# ENSEMBLE OCR CONFIGURATION
# ===============================================

# Pororo OCR 설정 (Kakaobrain)
pororo:
  api-url: ${PORORO_API_URL:http://localhost:9004}
  timeout: 60s

# EasyOCR 설정
easyocr:
  api-url: ${EASYOCR_API_URL:http://localhost:9005}
  timeout: 60s

# 앙상블 OCR 설정
ensemble:
  enabled: ${ENSEMBLE_ENABLED:true}  # 앙상블 모드 활성화
  timeout: 90  # 전체 앙상블 타임아웃 (초)